
apiVersion: v1
kind: ConfigMap
metadata:
  name: shiptrackr-sql
  namespace: default
data:
  init.sql: |

CREATE TABLE organizations (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    organization_id INTEGER NOT NULL REFERENCES organizations(id)
);

CREATE TABLE shipments (
    id SERIAL PRIMARY KEY,
    tracking_number VARCHAR(50) NOT NULL UNIQUE,
    carrier VARCHAR(100) NOT NULL,
    created_by INTEGER NOT NULL REFERENCES users(id)
);

CREATE TABLE status_history (
    id SERIAL PRIMARY KEY,
    shipment_id INTEGER NOT NULL REFERENCES shipments(id),
    timestamp TIMESTAMP NOT NULL,
    location VARCHAR(100) NOT NULL,
    status VARCHAR(50) NOT NULL
);

CREATE TABLE escalations (
    id SERIAL PRIMARY KEY,
    shipment_id INTEGER NOT NULL REFERENCES shipments(id),
    reason TEXT NOT NULL,
    escalated_at TIMESTAMP DEFAULT NOW()
);


  seed.sql: |

INSERT INTO organizations (id, name) VALUES (1, 'Nimbus Networks');
INSERT INTO users (id, username, organization_id) VALUES (1, 'user_1', 1);
INSERT INTO shipments (id, tracking_number, carrier, created_by) VALUES (1, 'TRK00001', 'ZenoExpress', 1);
INSERT INTO status_history (shipment_id, timestamp, location, status) VALUES (1, NOW() - INTERVAL '12 hours', 'New York, NY', 'created');
INSERT INTO escalations (shipment_id, reason, escalated_at) VALUES (1, 'Delayed delivery', NOW() - INTERVAL '6 hours');

